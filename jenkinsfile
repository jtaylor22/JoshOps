pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building..'
            }
        }
        stage('Test') {
            steps {
                echo 'Testing..'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
}

pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'tar $JENKINS_HOME directory'
                set +e 
                tar -cvf jenkins_backup.tar -C $JENKINS_HOME .
                exitcode=$?
                if [ "$exitcode" != "1" ] && [ "$exitcode" != "0" ]; then
                exit $exitcode
                fi
                set -e
                echo 'Upload jenkins_backup.tar to S3 bucket'
                aws s3 cp jenkins_backup.tar s3://test-joshops-bucket/
                echo 'Remove files after succesful upload to S3'
                rm -rf *
            }
        }
        stage('Test') {
            steps {
                echo 'Testing..'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
}